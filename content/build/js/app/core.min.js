function BookingRequestMarker(e){Component.call(this);var t,a,n=e,r=!1,o=function(){t.on("click",".btn-close",function(){t.off(),t.remove()}),t.on("click",".label",function(){s()}),t.on("focusin","input",function(){t.css("z-index",17)})},i=function(e){if(""!=e){var a={};if("object"==typeof e)a=e.project;else if(!isNaN(e)){var n=e.split(".");2==n.length&&(a=DataManager.getProjectByJobPhaseCode(n[0],n[1]))}var o=a.job?a.job.name+" ("+a.job.code+"."+a.phase.code+")":e,i=a.job?a.client.code:"";t.attr("title",o),t.find(".label").html(o),t.attr("data-client",i),t.attr("data-mode","set"),r=!0}else t.attr("data-client","");t.css("z-index",16)},s=function(){t.attr("title",""),t.find(".label").html(""),t.attr("data-mode","edit"),a.focus(),r=!1},l=function(e){var a=e?e.project.client.code:"";t.attr("data-client",a)},d=function(e){i(e)};this.getHtml=function(){var e='<div class="slot" data-type="'+n.type+'" data-id="'+n.id+'" data-index="'+n.index+'" data-start="'+n.start+'" data-duration="'+n.duration+'" data-client="" data-mode="edit" style="z-index: 16"><a href="#" class="btn btn-sm btn-sq btn-send"><i class="fa fa-send"></i></a><a href="#" class="label"></a><a href="#" class="btn btn-sm btn-sq btn-close"><i class="fa fa-close"></i></a></div>';return e},this.activate=function(){t=this.$self,a=new JobFinder(l,d),a.build('.slot[data-type="marker"][data-id="'+n.id+'"]'),a.activate(),o()}}function Component(){this.$self=null,this.getHtml=function(){return""},this.activate=function(){}}function CreateModal(){Component.call(this);var e,t,a=function(){t.on("click",".btn-close",function(){UIManager.closeModal()}),t.on("click",".btn-apply",function(){$(this).hasClass("disabled")||r()}),t.on("click",".btn-cancel",function(){UIManager.closeModal()})},n=function(){$("#input-start-date").datepicker({onSelect:function(){$("#input-end-date").prop("disabled",!1);var e=$("#input-start-date").datepicker("getDate");$("#input-end-date").datepicker("option","minDate",e)},dateFormat:"dd/mm/yy",beforeShowDay:$.datepicker.noWeekends}),$("#input-end-date").datepicker({onSelect:function(){$(".btn-apply").removeClass("disabled")},dateFormat:"dd/mm/yy",beforeShowDay:$.datepicker.noWeekends})},r=function(){var e=$("#input-start-date").datepicker("getDate"),t=$("#input-end-date").datepicker("getDate"),a=SettingsManager.getSetting("dateRangeSize");Core.loadData(e,t,a),UIManager.closeModal()};this.getHtml=function(){e=DataManager.getData();var t='<div class="modal"><div class="bar bar-lrg bar-title"><span>Load Dates</span><div class="bar-right"><a class="btn btn-lrg btn-sq btn-close" href="#"><i class="fa fa-close"></i></a></div></div><div class="modal-pane"><div class="modal-cnt"><div class="panel"><form><div class="row"><div class="col-6 col"><label for="start-date">Start Date</label><input class="u-full-width" type="text" placeholder="Select a start date" id="input-start-date"/></div><div class="col-6 col"><label for="end-date">End Date</label><input class="u-full-width" type="text" placeholder="Select an end date" id="input-end-date" disabled/></div></div></form></div></div></div><div class="bar bar-lrg"><div class="bar-right"><a class="btn btn-lrg btn-apply disabled" href="#"><span>Apply</span></a><a class="btn btn-lrg btn-cancel" href="#"><span>Cancel</span></a></div></div></div>';return t},this.activate=function(){t=this.$self,a(),n()}}function JobFilterModal(){Component.call(this);var e,t=function(){e.on("click",".btn-close",function(){UIManager.closeModal()}),e.on("click",".btn-select-all",function(){e.find(".filters input").prop("checked",!0)}),e.on("click",".btn-deselect-all",function(){e.find(".filters input").prop("checked",!1)}),e.on("click",".btn-apply",function(){r()}),e.on("click",".btn-cancel",function(){UIManager.closeModal()})},a=function(){e.on("click",".filters input",function(){var e=$(this),t=e.is(":checked");e.parent().parent().find("ul input").prop("checked",t),n(e)})},n=function(e){var t=e.parent().parent().parent().parent().find("> label input");if(t.length>0){var a=e.parent().parent().parent().children("li").children("label").children("input:checked").length;t.prop("checked",0!==a),n(t)}},r=function(){var t=e.find("#checkbox-restrict").is(":checked"),a=null,n=e.find(".filters ul ul input"),r=e.find(".filters ul ul input:checked");r.length<n.length&&(a=new Array,r.each(function(){var e=$(this).attr("id");a.push(e)})),DataManager.filterJobs(a,t),UIManager.closeModal(),UIManager.rebuildView()};this.getHtml=function(){var e=(DataManager.getData(),DataManager.getIsRestrictUsers()?" checked":""),t='<div class="modal"><div class="bar bar-lrg bar-title"><span>Filter Jobs</span><div class="bar-right"><a class="btn btn-lrg btn-sq btn-close" href="#"><i class="fa fa-close"></i></a></div></div><div class="bar bar-flexible"><div class="bar-left"><a class="btn btn-select-all" href="#">Select All</a><a class="btn btn-deselect-all" href="#">Deselect All</a><form><fieldset><label for="checkbox-restrict"><input id="checkbox-restrict" type="checkbox"'+e+'/><span>Restrict to Selection</span></label></fieldset></form></div></div><div class="modal-pane"><div class="modal-cnt">',a=DataManager.getClientsForDisplay(a);return t+='<div class="row"><div class="col-6 col">',t+=HtmlGenerator.getClientFilterList(a[0]),t+='</div><div class="col-6 col">',t+=HtmlGenerator.getClientFilterList(a[1]),t+="</div></div>",t+='</div></div><div class="bar bar-lrg"><div class="bar-right"><a class="btn btn-lrg btn-apply" href="#"><span>Apply</span></a><a class="btn btn-lrg btn-cancel" href="#"><span>Cancel</span></a></div></div></div>'},this.activate=function(){e=this.$self,t(),a()}}function JobFinder(e,t){Component.call(this);var a,n,r,o,i,s,l=e,d=t,c=function(){a.on("input","input",function(){f(),y()}),a.on("focusin","input",function(){y()}),a.on("focusout","input",function(){g()})},u=function(){a.on("click","li",function(){}),a.on("mouseover","li",function(){var e=parseInt($(this).attr("data-index"));v(e)}),a.on("mouseover","input",function(){v(-1)})},g=function(e){if(s.html(""),o>-1){var t=r[o];i.val(t.project.job.code+"."+t.project.phase.code),d(t)}else d(i.val())},f=function(e){if(o>-1){var t=r[o];l(t)}else l("")},h=function(){a.bind("keydown",function(e){var t=e.keyCode||e.which;if(13==t||38==t||40==t)switch(e.preventDefault(),t){case 13:g();break;case 40:v(o==-1?0:o+1);break;case 38:v(o-1)}})},v=function(e){e>-1?e<r.length&&(o=e,a.find(".active").removeClass("active"),$listItem=a.find("li:eq("+o+")"),$listItem.addClass("active"),M($listItem)):(o=-1,a.find(".active").removeClass("active")),f()},p=function(e,t,a){var n={};return n.client=e,n.job=t,n.phase=a,n},b=function(){n=[];for(var e=JSON.parse(JSON.stringify(DataManager.getData().projects)),t=0;t<e.length;t++)for(var a=e[t],r=0;r<a.jobs.length;r++)for(var o=a.jobs[r],i=0;i<o.phases.length;i++){var s=o.phases[i],l={};l.project=p(a,o,s),n.push(l)}n.sort(function(e,t){var e=e.project.client.code+e.project.job.code+"."+e.project.phase.code,t=t.project.client.code+t.project.job.code+"."+t.project.phase.code;return e<t?-1:e>t?1:0})},m=function(e,t){var a={};if(a.isMatched=!1,a.term=t,""!=e){for(var n=e.length,r=0,o=t.toLowerCase(),i=[],s=0;s<t.length-(n-1);s++){var l=o.substring(s,s+n);if(l==e){a.isMatched=!0;var d=t.substring(r,s),c="<strong>"+t.substring(s,s+n)+"</strong>";i.push(d),i.push(c),r=s+n,s=r}}var u=t.substring(r,t.length);i.push(u),a.term="";for(var s=0;s<i.length;s++)a.term+=i[s]}else a.isMatched=!0;return a},y=function(){r=[];var e=i.val();e=e.toString(),e=e.toLowerCase();for(var t=0;t<n.length;t++){var a=n[t].project,l=m(e,a.client.name),d=m(e,a.job.name),c=m(e,a.phase.name),u=m(e,a.job.code+"."+a.phase.code);if(l.isMatched||d.isMatched||c.isMatched||u.isMatched){var g={};g.project=a,g.html=l.term+"<br/>",g.html+=d.term+"<br/>",g.html+=c.term+"<br/>",g.html+=u.term,r.push(g)}}var f="";if(r.length>0){f+="<ul>";for(var t=0;t<r.length;t++){var g=r[t];f+='<li data-index="'+t+'"><nobr>'+g.html+"</nobr></li>"}f+="</ul>"}s.html(f),o=-1},M=function(e){var t=s.height(),a=s.scrollTop(),n=a+t,r=e.outerHeight(),o=e.position().top+a,i=o+r;o<a?s.scrollTop(o):i>n&&s.scrollTop(o-(t-r))};this.getHtml=function(){var e='<div class="auto-complete"><input type="text"><div class="dropdown"></div></div>';return e},this.activate=function(){a=this.$self,i=this.$self.find("input"),s=this.$self.find(".dropdown"),c(),u(),h(),b()},this.focus=function(){i.focus()}}function LoadErrorModal(){Component.call(this);var e,t=function(){e.on("click",".btn-close",function(){UIManager.closeModal()})};this.getHtml=function(){var e=DataLoader.getErrorMessage(),t='<div class="modal"><div class="bar bar-lrg bar-title"><span>Load Error</span><div class="bar-right"><a class="btn btn-lrg btn-sq btn-close" href="#"><i class="fa fa-close"></i></a></div></div><div class="modal-pane"><div class="modal-cnt"><div class="panel"><span>'+e+"</span></div></div></div></div>";return t},this.activate=function(){e=this.$self,t()}}function LoadOverlay(){Component.call(this),this.getHtml=function(){var e='<div class="overlay load-overlay"><div class="loader"><div class="pin"></div><div class="spinner"></div></div></div>';return e},this.activate=function(){}}function Overlay(){Component.call(this),this.getHtml=function(){var e='<div class="overlay"></div>';return e},this.activate=function(){this.$self.on("click",function(){UIManager.closeModal()})}}function SlotInfoModal(){Component.call(this);var e,t=(DataManager.getData(),function(){e.on("click",".btn-close",function(){UIManager.closeInfoModal()}),ZeroClipboard.config({swfPath:Core.baseURL+"/content/build/swf/zeroclipboard.swf"});new ZeroClipboard($(".copy"))}),a=function(){e.on("click",".panel-conflicts a",function(){DataManager.setSelectedResourceBySlotId($(this).attr("data-id")),UIManager.view.highlightSelectedSlot(),UIManager.openInfoModal(UIManager.slotInfoModal)})};this.getHtml=function(){var e=DataManager.getSelectedResource(),t=DataManager.getSelectedProject(),a=DataManager.getDayByIndex(e.booking.index),n='<div class="modal info-modal"><div class="bar bar-lrg bar-title"><div class="bar-left"><span>'+a.dateSimple+"</span><time>"+e.slot.start+" - "+e.slot.end+" ("+e.slot.duration+'hrs)</time></div><div class="bar-right"><a class="btn btn-lrg btn-sq btn-close" href="#"><i class="fa fa-close"></i></a></div></div><div class="modal-pane"><div class="modal-cnt"><div class="panel" data-client="'+t.client.code+'">';if(n+="<h2>",n+=t.client.url?'<a href="'+t.client.url+'" target="_blank">':"",n+=t.client.name,n+=t.client.url?' <i class="fa fa-external-link"></i></a>':"",n+="</h2><p><strong>Job:</strong> "+t.job.name+"<br/><strong>Phase:</strong> "+t.phase.name+"<br/><strong>Code:</strong> "+t.job.code+"."+t.phase.code+' <a href="#" class="icon-link copy" data-clipboard-text="'+t.job.code+"."+t.phase.code+'"><i class="fa fa-clipboard"></i> <span>copy</span></a></p>',e.slot.conflictSlots.length>0){n+='<div class="panel panel-conflicts"><h3>Conflicts:</h3><ul>';for(var r=e.slot.conflictSlots,o=0;o<r.length;o++){var i=r[o],s=DataManager.getProjectByJobPhaseCode(i.jobCode,i.phaseCode);n+='<li><a href="#" data-id="'+i.id+'"><i class="fa fa-warning"></i>'+s.client.name+" "+s.job.name+" ("+s.job.code+"."+s.phase.code+")</a></li>"}n+="</ul></div>"}return n+="</div></div></div></div>"},this.activate=function(){e=this.$self,t(),a()}}function UserFilterModal(){Component.call(this);var e,t,a=function(){t.on("click",".btn-close",function(){UIManager.closeModal()}),t.on("click",".btn-select-all",function(){t.find(".filters input").prop("checked",!0)}),t.on("click",".btn-deselect-all",function(){t.find(".filters input").prop("checked",!1)}),t.on("click",".btn-apply",function(){o()}),t.on("click",".btn-cancel",function(){UIManager.closeModal()})},n=function(){t.on("click",".filters input",function(){var e=$(this),t=e.is(":checked");e.parent().parent().find("ul input").prop("checked",t),r(e)})},r=function(e){var t=e.parent().parent().parent().parent().find("> label input");if(t.length>0){var a=e.parent().parent().parent().children("li").children("label").children("input:checked").length;t.prop("checked",0!==a),r(t)}},o=function(){var e=null,a=t.find(".filters ul input"),n=t.find(".filters ul input:checked");n.length<a.length&&(e=new Array,n.each(function(){var t=$(this).attr("id");e.push(t)})),DataManager.filterUsers(e),UIManager.closeModal(),UIManager.rebuildView()};this.getHtml=function(){e=DataManager.getData();for(var t='<div class="modal"><div class="bar bar-lrg bar-title"><span>Filter People</span><div class="bar-right"><a class="btn btn-lrg btn-sq btn-close" href="#"><i class="fa fa-close"></i></a></div></div><div class="bar"><div class="bar-left"><a class="btn btn-select-all" href="#">Select All</a><a class="btn btn-deselect-all" href="#">Deselect All</a></div></div><div class="modal-pane"><div class="modal-cnt">',a=e.resources,n=0;n<a.length;n++){var r=a[n];Calculator.isEven(n)&&(t+='<div class="row">'),t+='<div class="col-6 col"><div class="panel"><ul class="filters"><li>';var o=r.isFiltered?"":" checked";t+='<label for="'+r.code+'"><input id="'+r.code+'" type="checkbox" '+o+"/><span>"+r.name+"</span></label>";var i=r.users;if(i.length>0){t+="<ul>";for(var s=0;s<i.length;s++){var l=i[s];t+="<li>";var d=l.isFiltered?"":" checked";t+='<label for="'+l.code+'"><input id="'+l.code+'" type="checkbox" '+d+"/><span>"+l.name+"</span></label>",t+="</li>"}t+="</ul>"}t+="</li></ul></div></div>",Calculator.isOdd(n)&&(t+="</div>"),n==a.length-1&&Calculator.isOdd(a.length)&&(t+='<div class="col col-6">&nbsp;</div></div>')}return t+='</div></div><div class="bar bar-lrg"><div class="bar-right"><a class="btn btn-lrg btn-apply" href="#"><span>Apply</span></a><a class="btn btn-lrg btn-cancel" href="#"><span>Cancel</span></a></div></div></div>'},this.activate=function(){t=this.$self,a(),n()}}function View(){Component.call(this);var e,t,a,n,r,o,i,s,l,d,c,u,g,f,h,v,p,b,m,y,M,S,C,k,D,w,I,F=200,j=0,x=17,U=50,L=40,T=0,R=200,P=0,O=0,N=!1,H=function(){var t=UIManager.getScreenWidth(),a=UIManager.getScreenHeight(),n=SettingsManager.getSetting("zoom"),l=UIManager.getIsMobile();T=l?120:150,O=l?0:20,P=UIManager.getSlotInfoModalHeight();var d=SettingsManager.getSetting("showWeekends")?e.days.length:e.days.length-e.numWeekends,c=l?1:SettingsManager.getSetting("numDaysDisplay");c>d&&(c=d),r=t-T,o=(t-T-x)/c*d,s=100/d,R=a-(U+L*(n/100)+P+O),i=a-(U+L*(n/100)+P+O),j=o-r+x},B=function(){C.on("scroll",function(){var e=$(this).scrollLeft(),t=$(this).scrollTop();n=e/j,M.css("margin-left",-e+"px"),b.css("margin-top",-t+"px")})},J=function(){v.on("click",".cnt-bar",function(){var e=$(this).find("span"),t=$(".cnt:nth-child("+($(this).index()+2)+")"),a=$(this).index()/2;t.hasClass("cnt-open")?(e.html("+"),t.removeClass("cnt-open"),DataManager.setTeamVisibilityByIndex(a,!1)):(e.html("-"),t.addClass("cnt-open"),DataManager.setTeamVisibilityByIndex(a,!0))}),v.on("click",".slot",function(e){var t="true"==$(this).attr("data-filtered"),a="true"==$(this).attr("data-highlight"),n=$(this).attr("data-type");t||a||"set"!=n?("empty"==n&&"booking-request"==SettingsManager.getSetting("mode")&&(N?E($(this)):V($(this))),DataManager.resetSelectedResource(),UIManager.closeInfoModal()):(DataManager.setSelectedResourceBySlotId($(this).attr("data-id")),q(),UIManager.openInfoModal(UIManager.slotInfoModal))}),v.on("click",".section-calendar .body",function(e){null!==DataManager.getSelectedResource()&&"DIV"==e.target.nodeName&&UIManager.closeInfoModal()})},A=function(){v.bind("keydown",function(e){var t=e.keyCode||e.which;if(null!==DataManager.getSelectedResource()&&(37==t||38==t||39==t||40==t)){switch(e.preventDefault(),t){case 37:DataManager.setNextSelectedResource(-1,0);break;case 38:DataManager.setNextSelectedResource(0,-1);break;case 39:DataManager.setNextSelectedResource(1,0);break;case 40:DataManager.setNextSelectedResource(0,1)}q(),UIManager.openInfoModal(UIManager.slotInfoModal)}}),v.bind("keyup",function(e){var t=e.keyCode||e.which;null!==DataManager.getSelectedResource()&&(37!=t&&38!=t&&39!=t&&40!=t||_())})},z=function(){v.on("mouseover",'.slot[data-type="empty"]',function(e){N&&(u=$(this).parent().attr("data-user"),g=$(this).parent().attr("data-date"),f=parseInt($(this).attr("data-index")),h=DataManager.createBookingRequestSelection(l,d,c,u,g,f),W())})},V=function(e){N=!0,l=e.parent().attr("data-user"),d=e.parent().attr("data-date"),c=parseInt(e.attr("data-index")),I=e,I.attr("data-selected","true"),I.attr("data-valid","false")},W=function(){v.find('div[data-type="empty"]').attr("data-selected","false"),I.attr("data-selected","true");for(var e=h.subSelections,t=0;t<e.length;t++)for(var a=e[t],n=a.slotGroups,r=0;r<n.length;r++)for(var o=n[r],i=0;i<o.slots.length;i++){var s=o.slots[i],d=v.find('div[data-user="'+l+'"][data-date="'+a.dateStamp+'"] .slot[data-index="'+s.index+'"]');d.attr("data-selected","true"),d.attr("data-valid",s.isValid)}},E=function(){if(l==u){var e=DataManager.addMarkersFromBookingRequestSelection(h);if(e.length>0)for(var t=0;t<e.length;t++){var a=e[t],n=a.slot,r=new BookingRequestMarker(n);r.build('div[data-user="'+a.userCode+'"][data-date="'+a.dateStamp+'"]'),r.activate()}}v.find('div[data-type="empty"]').attr("data-selected","false"),h=null,N=!1},q=function(){v.find(".slot").attr("data-highlight",!1),w=v.find('.slot[data-id="'+DataManager.getSelectedResource().slot.id+'"]').attr("data-highlight",!0)},_=function(){if(w){var e=C.scrollLeft(),t=C.scrollTop();w.offset().left-T<0?e=Math.ceil(w.parent().offset().left-S.offset().left):w.offset().left+T-(UIManager.getScreenWidth()-x)>0&&(e=Math.ceil(w.parent().offset().left-S.offset().left-(C.outerWidth()-x)+w.parent().outerWidth())),w.offset().top-U-L<0?t=Math.ceil(w.offset().top-S.offset().top):w.offset().top+w.outerHeight()-(UIManager.getScreenHeight()-x-P-O)>0&&(t=Math.ceil(w.offset().top-S.offset().top-(C.outerHeight()-x)+w.outerHeight())),C.stop(!0,!1),C.animate({scrollLeft:e,scrollTop:t},F)}},G=function(){if(_$colToday){var e=C.scrollLeft();(_$colToday.offset().left-T<0||_$colToday.offset().left+T-(UIManager.getScreenWidth()-x)>0)&&(e=Math.ceil(_$colToday.offset().left+-1*S.offset().left)),C.stop(!0,!1),C.animate({scrollLeft:e},F)}};this.getHtml=function(){e=DataManager.getData(),t=SettingsManager.getSetting("zoom"),a=SettingsManager.getSetting("showWeekends"),_mode=SettingsManager.getSetting("mode"),_selectedResource=DataManager.getSelectedResource();for(var n='<div class="planner" data-mode="'+_mode+'" data-zoom="'+t+'" data-highlight="'+(null!==_selectedResource)+'"><div class="section section-users"><div class="pane"><div class="hdr"><div><span>People</span></div></div></div><div class="pane"><div class="body"><div>',r=e.resources,o=0;o<r.length;o++){var i=r[o];if(!i.isFiltered){var s=i.visible?" cnt-open":"",l=i.visible?"-":"+";n+='<div class="cnt-bar"><a href="#">'+i.name+"<span>"+l+'</span></a></div><div class="cnt'+s+'">';for(var d=i.users,c=0;c<d.length;c++){var u=d[c];u.isFiltered||(n+="<div><span>"+u.name+"</span></div>")}n+="</div>"}}n+='</div></div></div></div><div class="section section-calendar"><div class="pane"><div class="hdr">';for(var g=0;g<e.days.length;g++){var f=e.days[g];!a&&f.isWeekend||(n+='<div title="'+f.dateSimple+'" class="'+f.cssClass+'"><span>'+f.dateSimple+"</span></div>")}n+='</div></div><div class="pane"><div class="body">';for(var h=0;h<e.days.length;h++){var f=e.days[h];if(a||!f.isWeekend){n+='<div class="'+f.cssClass+'">';for(var r=e.resources,v=0;v<r.length;v++){var i=r[v];if(!i.isFiltered){var s=i.visible?" cnt-open":"";n+='<div class="cnt-bar"><a href="#">&nbsp;</a></div><div class="cnt'+s+'">';for(var d=i.users,p=0;p<d.length;p++){var u=d[p];if(!u.isFiltered){n+='<div data-user="'+u.code+'" data-date="'+f.dateStamp+'">';for(var b=u.bookings,m=0;m<b.length;m++){var y=b[m];if(y.index==f.index)for(var M=y.slots,S=0;S<M.length;S++){var C=M[S];if("set"==C.type){var k=DataManager.getProjectByJobPhaseCode(C.jobCode,C.phaseCode);n+='<div title="'+k.job.name+" ("+k.job.code+"."+k.phase.code+')" class="slot" data-type="'+C.type+'" data-id="'+C.id+'" data-index="'+C.index+'" data-start="'+C.start+'" data-duration="'+C.duration+'" data-all-day="'+C.allDay+'" data-client="'+k.client.code+'" data-double-booked="'+(C.conflictSlots.length>0)+'" data-highlight="false" data-filtered="'+k.phase.isFiltered+'"><a href="#">'+k.job.name+" ("+k.job.code+"."+k.phase.code+")</a></div>"}else"empty"==C.type&&"booking-request"==_mode&&(n+='<div title="'+C.start+" - "+C.end+'" class="slot" data-type="'+C.type+'" data-selected="false" data-id="'+C.id+'" data-index="'+C.index+'" data-start="'+C.start+'" data-duration="'+C.duration+'"><a href="#">&nbsp;</a></div>')}}n+="</div>"}}n+="</div>"}}n+="</div>"}}return n+="</div></div></div></div>"},this.activate=function(){v=this.$self,p=this.$self.find(".section-users"),b=this.$self.find(".section-users .body"),m=this.$self.find(".section-users .pane:eq(1)"),y=this.$self.find(".section-calendar"),M=this.$self.find(".section-calendar .hdr"),S=this.$self.find(".section-calendar .body"),C=this.$self.find(".section-calendar .pane:eq(1)"),k=this.$self.find(".section-calendar .hdr > div"),D=this.$self.find(".section-calendar .body > div"),_$colToday=this.$self.find(".body .today"),B(),J(),z(),A()},this.resize=function(){H(),p.css("width",T),y.css("width",r+"px"),M.css("width",o+"px"),S.css("width",o+"px"),k.css("width",s+"%"),D.css("width",s+"%"),m.css("maxHeight",R+"px"),C.css("maxHeight",i+"px")},this.reScroll=function(){C.scrollLeft(j*n)},this.highlightOn=function(){v.attr("data-highlight",!0)},this.highlightOff=function(){v.attr("data-highlight",!1),v.find(".slot").attr("data-highlight",!1)},this.highlightSelectedSlot=function(){q()},this.goToToday=function(){G()}}function ViewHeader(){Component.call(this);var e,t=function(){_$self.on("click","#btn-menu",function(){UIManager.isViewMenuOpen()?UIManager.closeMenu():UIManager.openMenu(UIManager.viewMenu)})};this.getHtml=function(){var e='<div class="view-hdr"><div class="bar bar-lrg bar-title" id="view-bar"><span>'+Core.title+'</span><div class="bar-left"><a title="Refresh" class="logo" href="'+Core.baseURL+'"><h1>Studio Planner</h1></a></div><div class="bar-right"><a class="btn btn-lrg btn-sq" id="btn-menu" href="#"><i class="fa fa-bars"></i></a></div></div></div>';return e},this.activate=function(){_$self=this.$self,_$title=this.$self.find(".bar > span"),e=this.$self.find("#btn-menu"),t()},this.viewMenuOn=function(){e.addClass("active")},this.viewMenuOff=function(){e.removeClass("active")},this.setTitle=function(e){_$title.html(e)}}function ViewMenu(){Component.call(this);var e,t,a,n,r,o,i=function(){t.on("click","#btn-new",function(){UIManager.openModal(UIManager.createModal)}),t.on("click","#btn-reset-dates",function(){SettingsManager.setSetting("startDate",null),SettingsManager.setSetting("endDate",null),Core.loadData(SettingsManager.getSetting("startDate"),SettingsManager.getSetting("endDate"),SettingsManager.getSetting("dateRangeSize")),UIManager.closeMenu()}),t.on("click","#btn-filter-jobs",function(){UIManager.openModal(UIManager.jobFilterModal)}),t.on("click","#btn-filter-people",function(){UIManager.openModal(UIManager.userFilterModal)}),t.on("click","#btn-go-today",function(){$(this).hasClass("disabled")||UIManager.view.goToToday()}),t.on("click","#btn-restore-defaults",function(){SettingsManager.restoreDefaults(),Core.loadData(SettingsManager.getSetting("startDate"),SettingsManager.getSetting("endDate"),SettingsManager.getSetting("dateRangeSize")),UIManager.closeMenu()})},s=function(){t.on("click","#checkbox-show-weekends",function(){var t=$(this).is(":checked");SettingsManager.setSetting("showWeekends",t);var a=SettingsManager.getSetting("numDaysDisplay"),n=e.dates.length-e.numWeekends;!t&&a>n&&SettingsManager.setSetting("numDaysDisplay",n),UIManager.rebuildView()}),t.on("click","#checkbox-booking-request-mode",function(){var e=$(this).is(":checked"),t=e?"booking-request":"default";SettingsManager.setSetting("mode",t),UIManager.rebuildView()})},l=function(){var e=SettingsManager.getSetting("zoom");r.noUiSlider({start:e,step:25,direction:"ltr",range:{min:50,max:150},serialization:{lower:[$.Link({target:o})],format:{decimals:0}}}).on({set:function(){SettingsManager.setSetting("zoom",r.val()),UIManager.rebuildView()}})},d=function(){var t=SettingsManager.getSetting("numDaysDisplay"),r=SettingsManager.getSetting("showWeekends"),o=r?e.dates.length:e.dates.length-e.numWeekends,i=o<t?o:t;UIManager.getIsMobile()&&(o=1,i=1),a.noUiSlider({start:i,step:1,direction:"ltr",range:{min:1,max:o},serialization:{lower:[$.Link({target:n})],format:{decimals:0}}}).on({set:function(){SettingsManager.setSetting("numDaysDisplay",a.val()),UIManager.rebuildView()}})};this.getHtml=function(){e=DataManager.getData();var t=SettingsManager.getSetting("showWeekends")?" checked":"",a="booking-request"==SettingsManager.getSetting("mode")?" checked":"",n=e.includesToday?"":" disabled",r=UIManager.getIsMobile()?" disabled":"",o='<ul class="menu menu-right"><li><ul><li><a id="btn-new" class="btn btn-lrg" href="#">Load Dates</a></li></ul></li><li><ul><li><a id="btn-filter-jobs" class="btn btn-lrg" href="#">Filter Jobs</a></li><li><a id="btn-filter-people" class="btn btn-lrg" href="#">Filter People</a></li></ul></li><li><ul><li><a id="btn-go-today" class="btn btn-lrg'+n+'" href="#">Go to Today</a></li><li><div class="bar bar-lrg"><div class="noUi-slider'+r+'"><div id="slider-days"'+r+'></div><label>Days</label><span id="slider-output-days">5</span></div></div></li><li><div class="bar bar-lrg"><div class="noUi-slider"><label>Zoom</label><div id="slider-zoom"></div><span id="slider-output-zoom">100</span></div></div></li><li><div class="bar bar-lrg"><label for="checkbox-show-weekends"><input id="checkbox-show-weekends" type="checkbox"'+t+'/><span>Show Weekends</span></label></div></li></ul></li><li><ul><li><div class="bar bar-lrg"><label for="checkbox-booking-request-mode"><input id="checkbox-booking-request-mode" type="checkbox"'+a+'/><span>Booking Request Mode</span></label></div></li></ul></li><li><ul><li><a id="btn-reset-dates" class="btn btn-lrg" href="#">Reset Dates</a></li><li><a id="btn-restore-defaults" class="btn btn-lrg" href="#">Restore Defaults</a></li></ul></li></ul>';return o},this.activate=function(){t=this.$self,a=this.$self.find("#slider-days"),n=this.$self.find("#slider-output-days"),r=this.$self.find("#slider-zoom"),o=this.$self.find("#slider-output-zoom"),i(),s(),l(),d()}}var Calculator=function(){var e=function(e){return e==parseFloat(e)};return{isEven:function(t){return e(t)&&t%2==0},isOdd:function(t){return e(t)&&Math.abs(t)%2==1}}}(),ConsoleLogger=function(){return{log:function(e,t){console.log(e+": "+t)},startTimer:function(e){},stopTimer:function(e){}}}(),DateFactory=function(){var e=function(e,t){return t||(0==e.getDay()?e.setDate(e.getDate()+1):6==e.getDay()&&e.setDate(e.getDate()+2)),e},t=function(t,a,n){if(!(t instanceof Date&&a instanceof Date))return void(Core.debug&&ConsoleLogger.log("DateFactory","startDate and endDate must be an instanceof Date"));var r=new Array;for(t=e(t,n),a.setDate(a.getDate()+1);DateTimeFormatter.getDateStamp(t)!==DateTimeFormatter.getDateStamp(a);)n?r.push(new Date(t)):0!==t.getDay()&&6!==t.getDay()&&r.push(new Date(t)),t.setDate(t.getDate()+1);return r},a=function(t,a,n){if(!(t instanceof Date)||"number"!=typeof a)return void(Core.debug&&ConsoleLogger.log("DateFactory","startDate must be an instanceof Date and dateRangeSize must be typeof number"));var r=new Array;t=e(t,n);for(var o=0;o<a;)n?(r.push(new Date(t)),o++):0!==t.getDay()&&6!==t.getDay()&&(r.push(new Date(t)),o++),t.setDate(t.getDate()+1);return r};return{getDates:function(e,n,r,o){var i;return i=null!==n?t(e,n,o):a(e,r,o)}}}(),DateTimeFormatter=function(){var e=new Array("Sun","Mon","Tue","Wed","Thu","Fri","Sat"),t=new Array("Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec");return{getDateStamp:function(e){var t=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),r=t+"-"+a+"-"+n;return r},getSimpleFormat:function(a){var n=e[a.getDay()]+" "+a.getDate()+" "+t[a.getMonth()];return n},isDateWeekend:function(e){var t=0==e.getDay()||6==e.getDay();return t},isDateToday:function(e){var t=this.getDateStamp(new Date)==this.getDateStamp(e);return t},getFormattedTime:function(e){return("0"+parseInt(e)).slice(-2)+":"+e.slice(-2)},getNumberFromTime:function(e){return parseInt(e.substring(0,2))+parseInt(e.slice(-2))/60},getTimeFromNumber:function(e){var t=Math.floor(e),a=e-t;return a=.5==a?"30":"00",this.getFormattedTime(t+":"+a)}}}(),HtmlGenerator=function(){var e,t=function(a){var n=a[0].split(":"),r=n[0],o=n[1];e+="<"+r,o&&(e+=" "+o),e+=">";for(var i=1;i<a.length;i++){var s=a[i];"string"==typeof s?e+=s:"function"==typeof s?e+=s():t(s)}e+="</"+r+">"};return{parse:function(a){return e="",t(a),e},getClientFilterList:function(e){for(var t="",a=0;a<e.length;a++){var n=e[a];t+='<div class="panel" data-client="'+n.code+'"><ul class="filters"><li>';var r=n.isFiltered?"":" checked";t+='<label for="'+n.code+'"><input id="'+n.code+'" type="checkbox" '+r+"/><span>"+n.name+"</span></label>";var o=n.jobs;if(o.length>0){t+="<ul>";for(var i=0;i<o.length;i++){var s=o[i];t+="<li>";var l=s.isFiltered?"":" checked";t+='<label for="'+s.code+'"><input id="'+s.code+'" type="checkbox" '+l+"/><span>"+s.code+" - "+s.name+"</span></label>";var d=s.phases;if(d.length>0){t+="<ul>";for(var c=0;c<d.length;c++){var u=d[c];t+="<li>";var g=u.isFiltered?"":" checked";t+='<label for="'+s.code+"-"+u.code+'"><input id="'+s.code+"-"+u.code+'" type="checkbox" '+g+"/><span>"+u.code+" - "+u.name+"</span></label></li>"}t+="</ul>"}t+="</li>"}t+="</ul>"}t+="</li></ul></div>"}return t}}}(),TextFormatter=function(){return{getID:function(e,t){var e=e.replace(/\s+/g,"-").toLowerCase();return t&&(e+="-"+("0"+t).slice(-2)),e}}}(),DataLoader=function(){var e,t,a="",n="",r="",o=function(a){t=DataLoaderStatus.SUCCESS,_successCallback(a),e=null},i=function(a){n=a.textStatus,r=a.error,t=DataLoaderStatus.FAILED,_failCallback(),e=null},s=function(){t=DataLoaderStatus.CANCELLED,e=null};return{load:function(t,n,r){_successCallback=n,_failCallback=r,e&&this.cancel(),a=Core.baseURL+"/content/temp/data.json",Core.debug&&ConsoleLogger.log("DataLoader","Loading data from: "+a),e=$.getJSON(a).done(function(e){Core.debug&&ConsoleLogger.log("DataLoader","Data loaded successfully");var a={};a.data=e,a.dates=t,o(a)}).fail(function(e,t,a){Core.debug&&ConsoleLogger.log("DataLoader","Data failed to load");var n={};n.textStatus=t,n.error=a,i(n)})},cancel:function(){Core.debug&&ConsoleLogger.log("DataLoader","Cancelling loading of data"),e.abort(),s()},getStatus:function(){return t},getErrorMessage:function(){var e="";return e+=n?"<strong>Status:</strong>  "+n+"<br/>":"Status: unspecified<br/>",e+=r?"<strong>Error:</strong>  "+r+"<br/>":"<strong>Error:</strong> unspecified<br/>",e+='<strong>Request URL:</strong> <a href="'+a+'" target="_blank">'+a+"</a>"}}}(),DataLoaderStatus=function(){return{SUCCESS:"SUCCESS",FAILED:"FAILED",CANCELLED:"CANCELLED"}}(),CookieManager=function(){return{createCookie:function(e,t,a){if(a){var n=new Date;n.setTime(n.getTime()+24*a*60*60*1e3);var r="; expires="+n.toGMTString()}else var r="";document.cookie=e+"="+t+r+"; path=/"},readCookie:function(e){for(var t=e+"=",a=document.cookie.split(";"),n=0;n<a.length;n++){for(var r=a[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null},eraseCookie:function(e){this.createCookie(e,"",-1)},replaceCookie:function(e,t,a){this.eraseCookie(e),this.createCookie(e,t,a)}}}(),DataManager=function(){var e,t=!1,a=function(t){day={},day.index=e.days.length,day.date=t,day.dateStamp=DateTimeFormatter.getDateStamp(t),day.dateSimple=DateTimeFormatter.getSimpleFormat(t),day.isWeekend=DateTimeFormatter.isDateWeekend(t),day.isToday=DateTimeFormatter.isDateToday(t),day.cssClass="",day.isToday&&(day.cssClass="today",
e.includesToday=!0),day.isWeekend&&e.numWeekends++,e.days.push(day)},n=function(t,a){var n=d(a);null==n&&(n={},n.index=e.resources.length,n.name=a,n.code=a.replace(/\s+/g,"-").toLowerCase(),n.visible=!0,n.users=new Array,e.resources.push(n)),t.index=n.users.length,n.users.push(t)},r=function(t,a,n,r,o,i,s,l,d){var f=c(a);null==f&&(f={},f.name=t,f.code=a,f.url=n,f.logoUrl=r,f.jobs=new Array,e.projects.push(f));var h=u(i);null==h&&(h={},h.name=o,h.code=i,h.phases=new Array,f.jobs.push(h));var v=g(l,i);null==v&&(v={},v.name=s,v.code=l,h.phases.push(v))},o=function(e){for(var t=e.subSelections,a=0;a<t.length;a++){var n=t[a],r=n.slots;n.slotGroups=[];for(var o,i=0;i<r.length;i++){var s=r[i],l=r[i-1];0==i&&(o=y()),l&&l.endNum!=s.startNum&&(n.slotGroups.push(o),o=y()),o.slots.push(s),i==r.length-1&&n.slotGroups.push(o)}}return e},i=function(t){for(var a=null,n=e.days,r=0;r<n.length;r++){var o=n[r];if(o.index==t){a=o;break}}return a},s=function(t){for(var a=null,n=e.days,r=0;r<n.length;r++){var o=n[r];if(o.dateStamp==t){a=o;break}}return a},l=function(t){for(var a=null,n=e.resources,r=0;r<n.length;r++)for(var o=n[r],i=o.users,s=0;s<i.length;s++){var l=i[s];if(l.code==t){a=l;break}}return a},d=function(t){for(var a=null,n=e.resources,r=0;r<n.length;r++){var o=n[r];if(o.name==t){a=o;break}}return a},c=function(t){for(var a=null,n=e.projects,r=0;r<n.length;r++){var o=n[r];if(o.code==t){a=o;break}}return a},u=function(t){for(var a=null,n=e.projects,r=0;r<n.length;r++)for(var o=n[r].jobs,i=0;i<o.length;i++){var s=o[i];if(s.code==t){a=s;break}}return a},g=function(t,a){for(var n=null,r=e.projects,o=0;o<r.length;o++)for(var i=r[o].jobs,s=0;s<i.length;s++){var l=i[s];if(l.code==a)for(var d=l.phases,c=0;c<d.length;c++){var u=d[c];if(u.code==t){n=u;break}}}return n},f=function(){for(var t=0,a=e.projects,n=0;n<a.length;n++)for(var r=a[n].jobs,o=0;o<r.length;o++){t++;for(var i=r[o].phases,s=0;s<i.length;s++)t++}return t},h=function(){for(var a=new Array,n=e.resources,r=0;r<n.length;r++){var o=n[r];o.isFiltered=!0;for(var i=o.users,s=0,l=0;l<i.length;l++){var d=!1,c=i[l];c.isFiltered=!0;for(var u=c.bookings,g=0;g<u.length;g++){for(var f=u[g],h=f.slots,v=0;v<h.length;v++){var p=h[v];if("empty"!=p.type){var b=DataManager.getProjectByJobPhaseCode(p.jobCode,p.phaseCode);if(!b.phase.isFiltered){d=!0,c.isFiltered=!1,a.push(c.code),s++;break}}}if(d)break}}s==i.length&&(o.isFiltered=!1)}t=!0,SettingsManager.setSetting("restrictUsers",t),SettingsManager.setSetting("userFilters",a),DataManager.filterUsers(SettingsManager.getSetting("userFilters"))},v=function(){for(var t=new Array,a=e.resources,n=0;n<a.length;n++){var r=a[n];r.visible||t.push(r.name)}SettingsManager.setSetting("hiddenTeams",t)},p=function(){for(var a=!0,n=e.resources,r=0;r<n.length;r++)for(var o=n[r],i=o.users,s=0;s<i.length;s++){for(var l=i[s],d=l.bookings,c=0,u=0;u<d.length;u++){for(var g=d[u],f=g.slots,h=0,v=0;v<f.length;v++){var p=f[v];if("empty"!=p.type){var b=DataManager.getProjectByJobPhaseCode(p.jobCode,p.phaseCode);if(l.isFiltered&&!b.phase.isFiltered){a=!1;break}b.phase.isFiltered&&h++}}if(!a)break;h==f.length&&c++}if(!a)break;if(!l.isFiltered&&c==d.length){a=!1;break}}t=a,SettingsManager.setSetting("restrictUsers",t)},b=function(t){if(t)for(var a=e.resources,n=0;n<a.length;n++)for(var r=a[n],o=0;o<t.length;o++){var i=t[o];if(r.name==i){r.visible=!1;break}}},m=function(e,t,a,n,r,o,i,s,l,d,c){var u={};return u.id=t,u.index=a,u.start=DateTimeFormatter.getFormattedTime(n),u.end=DateTimeFormatter.getFormattedTime(r),u.duration=o,u.allDay=i,u.jobCode=s,u.phaseCode=l,u.accountManager=d?d.Name:"",u.producer=c?c.Name:"",u.conflictSlots=new Array,u.type=e,u.startNum=DateTimeFormatter.getNumberFromTime(u.start),u.endNum=DateTimeFormatter.getNumberFromTime(u.end),u},y=function(e){var t={};return t.allDay=!1,t.isValid=!0,t.duration=0,t.slots=[],t},M=function(e){for(var t=e.subSelections,a=0;a<t.length;a++)for(var n=t[a],r=n.slotGroups,o=0;o<r.length;o++){var i=r[o],s=i.slots[0],l=i.slots[i.slots.length-1],d=l.endNum-s.startNum;if(i.duration=d,8==d)i.allDay=!0,i.duration=7,i.slots[i.slots.length-1].isValid=!1,i.slots[i.slots.length-2].isValid=!1;else if(d<1.5){i.isValid=!1;for(var c=0;c<i.slots.length;c++)i.slots[c].isValid=!1}}return e};return{parseData:function(t,o){Core.debug&&ConsoleLogger.log("DataManager","Parsing data"),e={},e.dates=t,e.days=new Array,e.numWeekends=0,e.includesToday=!1,e.resources=new Array,e.projects=new Array,e.selectedResource=null,e.selectedProject=null;for(var i=0;i<t.length;i++){var s=t[i];a(s)}for(var l=0,d=o,c=0;c<d.length;c++){var u=d[c],g={};g.name=u.Username,g.code=u.Username.replace(/\s+/g,"-").toLowerCase();var f=u.Bookings;if(f.length>0){g.bookings=new Array;for(var h=0;h<f.length;h++){var v=f[h];if(!e.days[h].isWeekend){var p={};p.index=h,p.day=this.getDayByIndex(p.index),p.slots=new Array;for(var y=new Array,M=new Array,S=9,C=16.5,k=.5,D=S,w=v.Slots.sort(function(e,t){return parseInt(e.StartFormatted)-parseInt(t.StartFormatted)}),I=0,F=S;F<=C;F+=k){for(var j=!0,x=0;x<w.length;x++){var U=w[x],$=DateTimeFormatter.getNumberFromTime(DateTimeFormatter.getFormattedTime(U.StartFormatted));if($==F){j=!1;var L=m("set",l,I,U.StartFormatted,U.EndFormatted,U.Duration,U.AllDay,U.CodeJob,U.CodePhase,U.AccountManager,U.Producer);p.slots.push(L),y.push(L.startNum),M.push(L.endNum),I++,l++,r(U.Client.Name,U.Client.FriendlyName,U.Client.Url,U.Client.LogoUrl,U.Job,U.CodeJob,U.Phase,U.CodePhase),L.allDay?D=16:D<L.endNum&&(D=L.endNum)}}if(j){var T=l,R=I,P=DateTimeFormatter.getTimeFromNumber(F),O=DateTimeFormatter.getTimeFromNumber(F+k),N=k,H=m("empty",T,R,P,O,N,!1);p.slots.push(H),y.push(L.startNum),M.push(L.endNum),I++,l++,D=H.endNum}F=D-k}var B=p.slots;for(R=0;R<B.length;R++){var J=B[R];if("empty"!=J.type)for(otherIndex=0;otherIndex<B.length;otherIndex++){var A=B[otherIndex];"empty"!=A.type&&R!=otherIndex&&(y[R]==y[otherIndex]||y[R]<y[otherIndex]&&M[R]>y[otherIndex]||y[R]>y[otherIndex]&&y[R]<M[otherIndex])&&J.conflictSlots.push(A)}}g.bookings.push(p)}}}n(g,u.TeamName)}this.filterJobs(SettingsManager.getSetting("jobFilters"),SettingsManager.getSetting("restrictUsers")),this.filterUsers(SettingsManager.getSetting("userFilters")),b(SettingsManager.getSetting("hiddenTeams")),e.jobPhaseCodes=[];for(var z=e.projects,F=0;F<z.length;F++)for(var V=z[F],W=V.jobs,x=0;x<W.length;x++)for(var E=W[x],q=E.phases,_=0;_<q.length;_++){var G=q[_];e.jobPhaseCodes.push(E.code+"."+G.code)}return e},getData:function(){return e},filterJobs:function(a,n){if(null!==a)for(var r=e.projects,o=0;o<r.length;o++){var i=r[o];i.isFiltered=!0;for(var s=i.jobs,l=0,d=0;d<s.length;d++){var c=s[d];c.isFiltered=!0;for(var u=c.phases,g=0,f=0;f<u.length;f++){var v=u[f];v.isFiltered=!0;for(var p=0;p<a.length;p++){var b=a[p].split("-"),m=b[0],y=b[1];if(m==c.code&&y==v.code){v.isFiltered=!1,g++;break}}}g>0&&(c.isFiltered=!1,l++)}l>0&&(i.isFiltered=!1)}else for(var r=e.projects,M=0;M<r.length;M++){var i=r[M];i.isFiltered=!1;for(var s=i.jobs,S=0;S<s.length;S++){var c=s[S];c.isFiltered=!1;for(var u=c.phases,C=0;C<u.length;C++){var v=u[C];v.isFiltered=!1}}}n?h():n!==t&&this.filterUsers(null),SettingsManager.setSetting("jobFilters",a)},filterUsers:function(t){if(null!==t)for(var a=e.resources,n=0;n<a.length;n++){var r=a[n];r.isFiltered=!0;for(var o=r.users,i=0,s=0;s<o.length;s++){var l=o[s];if(l.isFiltered=!0,t)for(var d=0;d<t.length;d++){var c=t[d];if(c==l.code){l.isFiltered=!1,i++;break}}}i>0&&(r.isFiltered=!1)}else for(var a=e.resources,u=0;u<a.length;u++){var r=a[u];r.isFiltered=!1;for(var o=r.users,g=0;g<o.length;g++){var l=o[g];l.isFiltered=!1}}p(),SettingsManager.setSetting("userFilters",t)},getIsRestrictUsers:function(){return t},getProjectByJobPhaseCode:function(t,a){for(var n={},r=e.projects,o=0;o<r.length;o++)for(var i=r[o],s=i.jobs,l=0;l<s.length;l++){var d=s[l];if(d.code==t)for(var c=d.phases,u=0;u<c.length;u++){var g=c[u];if(g.code==a){n.client=i,n.job=d,n.phase=g;break}}}return n},getResourceBySlotId:function(t){for(var a={},n=e.resources,r=0;r<n.length;r++)for(var o=n[r],i=o.users,s=0;s<i.length;s++)for(var l=i[s],d=l.bookings,c=0;c<d.length;c++)for(var u=d[c],g=u.slots,f=0;f<g.length;f++){var h=g[f];if(h.id==t){a.team=o,a.user=l,a.booking=u,a.slot=h;break}}return a},setSelectedResourceBySlotId:function(t){e.selectedResource=this.getResourceBySlotId(t),e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode)},resetSelectedResource:function(){e.selectedResource=null,e.selectedProject=null},setNextSelectedResource:function(t,a){var n=e.selectedResource,r=n.team.index,o=n.user.index,i=n.booking.index,s=n.slot.index;if(0!==a)if(1==a)for(var l=e.resources,d=0;d<l.length;d++)for(var c=l[d],u=c.users,g=0;g<u.length;g++){var f=u[g];if((c.index==r&&f.index>o||c.index>r)&&c.visible&&!f.isFiltered)for(var h=f.bookings,v=0;v<h.length;v++)for(var p=h[v],b=p.slots,m=0;m<b.length;m++){var y=b[m];if("empty"!=y.type){var M=this.getProjectByJobPhaseCode(y.jobCode,y.phaseCode);if(p.index==i&&!M.phase.isFiltered)return n.team=c,n.user=f,n.booking=p,n.slot=y,e.selectedResource=n,void(e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode))}}}else if(a==-1)for(var l=e.resources,d=l.length-1;d>=0;d--)for(var c=l[d],u=c.users,g=u.length-1;g>=0;g--){var f=u[g];if((c.index==r&&f.index<o||c.index<r)&&c.visible&&!f.isFiltered)for(var h=f.bookings,S=0;S<h.length;S++)for(var p=h[S],b=p.slots,m=0;m<b.length;m++){var y=b[m];if("empty"!=y.type){var M=this.getProjectByJobPhaseCode(y.jobCode,y.phaseCode);if(p.index==i&&!M.phase.isFiltered)return n.team=c,n.user=f,n.booking=p,n.slot=y,e.selectedResource=n,void(e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode))}}}if(0!==t)if(1==t)for(var h=e.resources[r].users[o].bookings,d=0;d<h.length;d++)for(var p=h[d],b=p.slots,g=0;g<b.length;g++){var y=b[g];if("empty"!=y.type){var M=this.getProjectByJobPhaseCode(y.jobCode,y.phaseCode);if((p.index==i&&y.index>s||p.index>i)&&!M.phase.isFiltered)return n.booking=p,n.slot=y,e.selectedResource=n,void(e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode))}}else if(t==-1)for(var h=e.resources[r].users[o].bookings,d=h.length-1;d>=0;d--)for(var p=h[d],b=p.slots,g=b.length-1;g>=0;g--){var y=b[g];if("empty"!=y.type){var M=this.getProjectByJobPhaseCode(y.jobCode,y.phaseCode);if((p.index==i&&y.index<s||p.index<i)&&!M.phase.isFiltered)return n.booking=p,n.slot=y,e.selectedResource=n,void(e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode))}}e.selectedResource=n,e.selectedProject=this.getProjectByJobPhaseCode(e.selectedResource.slot.jobCode,e.selectedResource.slot.phaseCode)},getSelectedResource:function(){return e.selectedResource},getSelectedProject:function(){return e.selectedProject},getDayByIndex:function(t){for(var a=null,n=e.days,r=0;r<n.length;r++){var o=n[r];if(o.index==t){a=o;break}}return a},setTeamVisibilityByIndex:function(t,a){for(var n=e.resources,r=0;r<n.length;r++){var o=n[r];if(o.index==t){o.visible=a;break}}v()},getClientsForDisplay:function(){var t,a=f(),n=Math.round(a/2),r=0,o=e.projects.sort(function(e,t){return e.code.localeCompare(t.code)});e:for(var i=0;i<o.length;i++)for(var s=o[i].jobs,l=0;l<s.length;l++){if(r==n){t=[o.slice(0,i),o.slice(i)];break e}r++;for(var d=s[l].phases,c=0;c<d.length;c++){if(r==n){t=[o.slice(0,i),o.slice(i)];break e}r++}}return t},createBookingRequestSelection:function(e,t,a,n,r,d){var c={};c.subSelections=[];var u=s(t).index,g=s(r).index;if(e==n)for(var f=l(e),h=f.bookings,v=0;v<h.length;v++){var p=h[v],b=p.day.index;p.day.dateStamp;if(b>=u&&b<=g){var m=p.slots,y={};y.userCode=e,y.dateStamp=i(b).dateStamp,y.slots=[];var S,C;u==g?(S=a,C=d):u==b?(S=a,C=p.slots.length-1):g==b?(S=0,C=d):(S=0,C=p.slots.length-1);for(var k=S;k<=C;k++){var D=m[k];D.isValid=!0,"empty"==D.type&&y.slots.push(D)}c.subSelections.push(y)}}return c=o(c),c=M(c)},addMarkersFromBookingRequestSelection:function(e){var t=[];if(e)for(var a=e.subSelections,n=0;n<a.length;n++)for(var r=a[n],o=r.slotGroups,i=0;i<o.length;i++){var s=o[i];if(s.isValid){var l={},d=s.slots[0],c=s.allDay?s.slots[s.slots.length-3]:s.slots[s.slots.length-1],u=d.id,g=d.index,f=DateTimeFormatter.getFormattedTime(d.start),h=DateTimeFormatter.getFormattedTime(c.end),v=s.duration,p=s.allDay,b=m("marker",u,g,f,h,v,p);l.userCode=r.userCode,l.dateStamp=r.dateStamp,l.slot=b,t.push(l)}}return t},getBookingRequestMarkerByUserNameDateStamp:function(){var e=null;return e}}}(),SettingsManager=function(){var e,t=1,a="settings",n=function(){var n=JSON.stringify(e);CookieManager.replaceCookie(a,n,t)},r=function(){var e={name:"Studio Planner",startDate:null,endDate:null,dateRangeSize:15,showWeekends:!0,mode:"default",zoom:100,numDaysDisplay:5,hiddenTeams:null,jobFilters:null,userFilters:null,restrictUsers:!1};return e};return{init:function(){var n=CookieManager.readCookie(a);null==n?(e=r(),n=JSON.stringify(e),CookieManager.createCookie(a,n,t),Core.debug&&ConsoleLogger.log("SettingsManager","Created settings cookie: "+n)):(Core.debug&&ConsoleLogger.log("SettingsManager","Found settings cookie: "+n),e=JSON.parse(n))},restoreDefaults:function(){e=r(),n()},getSetting:function(t){if(e.hasOwnProperty(t)){var a;switch(t){case"startDate":a=null==e[t]?new Date:new Date(e[t]);break;case"endDate":a=null==e[t]?null:new Date(e[t]);break;case"dateRangeSize":a=parseInt(e[t]);break;case"showWeekends":a=Boolean(e[t]);break;case"zoom":a=parseInt(e[t]);break;case"numDaysDisplay":a=parseInt(e[t]);break;default:a=e[t]}return a}},setSetting:function(t,a){e.hasOwnProperty(t)&&(e[t]=a),n()}}}(),UIManager=function(){var e,t,a,n=550,r=!1,o=null,i=null,s=null,l=function(){e=$(window).width(),t=$(window).height(),r=e<n,UIManager.view&&UIManager.view.resize()},d=function(){$(window).resize(function(){l()}),$(window).bind("keydown",function(e){var t=e.keyCode||e.which;27==t&&(null!==o&&UIManager.closeMenu(),null!==i&&UIManager.closeModal(),null!==s&&UIManager.closeInfoModal())})};return{viewHeader:null,view:null,viewMenu:null,createModal:null,jobFilterModal:null,userFilterModal:null,slotInfoModal:null,loadErrorModal:null,overlay:null,loadOverlay:null,init:function(){Core.debug&&ConsoleLogger.log("UIManager","Initializing"),a=Core.appSelector,l(),d()},buildComponents:function(){Core.debug&&ConsoleLogger.log("UIManager","Building components"),this.viewHeader=new ViewHeader,this.viewHeader.build(a),this.overlay=new Overlay,this.overlay.build("body"),this.overlay.activate(),this.loadOverlay=new LoadOverlay,this.loadOverlay.build("body"),this.loadOverlay.activate(),this.loadErrorModal=new LoadErrorModal},buildDataComponents:function(){Core.debug&&ConsoleLogger.log("UIManager","Building data components"),this.view=new View,this.view.build(a),this.view.activate(),this.view.resize(),this.viewMenu=new ViewMenu,this.viewMenu.build(".view-hdr"),this.viewMenu.activate(),this.viewHeader.activate(),this.createModal=new CreateModal,this.jobFilterModal=new JobFilterModal,this.userFilterModal=new UserFilterModal,this.slotInfoModal=new SlotInfoModal},rebuildView:function(){Core.debug&&ConsoleLogger.log("UIManager","Rebuilding view"),null!==s&&this.closeInfoModal(),this.view.build(a),this.view.activate(),this.view.resize(),this.view.reScroll(),this.view.highlightOff()},openMenu:function(e){o=e,o==this.viewMenu&&this.viewHeader.viewMenuOn(),o.build(a),o.activate(),o.$self.show()},closeMenu:function(){o==this.viewMenu&&this.viewHeader.viewMenuOff(),o.$self.hide(),o=null},openModal:function(e){i=e,i.build(a),i.activate(),i.$self.show(),this.overlay.$self.show(),null!==o&&this.closeMenu()},closeModal:function(){i.$self.hide(),this.overlay.$self.hide(),i=null},openInfoModal:function(e){s=e,s.build(a),s.activate(),s.$self.show(),this.view.highlightOn(),this.view.resize(),null!==o&&this.closeMenu()},closeInfoModal:function(){s&&(s.$self.hide(),s=null,this.view.highlightOff(),this.view.resize())},openLoadOverlay:function(){this.loadOverlay.$self.show()},closeLoadOverlay:function(){this.loadOverlay.$self.hide()},getIsMobile:function(){return r},getScreenWidth:function(){return e},getScreenHeight:function(){return t},getSlotInfoModalHeight:function(){var e=s?s.$self.outerHeight():0;return e},isViewMenuOpen:function(){return o==this.viewMenu}}}();BookingRequestMarker.prototype=Object.create(Component.prototype),Component.prototype.build=function(e){if(null!==this.$self){var t=$(this.getHtml());this.$self.replaceWith(t),this.$self=t}else if("undefined"!=typeof e){var a=$(e);a.length>0?this.$self=$(this.getHtml()).appendTo(e):Core.debug&&ConsoleLogger.log("Component",'The parent selector string passed to the ".build()" method does not match any DOM element.')}else Core.debug&&ConsoleLogger.log("Component",'The component has not yet been appended to the DOM. Use "component.build(parentSelector)" to add it to the DOM, "component.build()" can be used later to refresh the component\'s html.')},CreateModal.prototype=Object.create(Component.prototype),JobFilterModal.prototype=Object.create(Component.prototype),JobFinder.prototype=Object.create(Component.prototype),LoadErrorModal.prototype=Object.create(Component.prototype),LoadOverlay.prototype=Object.create(Component.prototype),Overlay.prototype=Object.create(Component.prototype),SlotInfoModal.prototype=Object.create(Component.prototype),UserFilterModal.prototype=Object.create(Component.prototype),View.prototype=Object.create(Component.prototype),ViewHeader.prototype=Object.create(Component.prototype),ViewMenu.prototype=Object.create(Component.prototype);var Core=function(){var e=!0,t=function(t){Core.debug&&ConsoleLogger.stopTimer("Core._handleDataLoaderSuccess()"),Core.debug&&ConsoleLogger.log("Core","Handling DataLoader success"),DataManager.parseData(t.dates,t.data),e?UIManager.buildDataComponents():UIManager.rebuildView(),UIManager.viewHeader.setTitle(Core.title),e||(SettingsManager.setSetting("startDate",t.dates[0]),SettingsManager.setSetting("endDate",t.dates[t.dates.length-1])),setTimeout(function(){UIManager.closeLoadOverlay()},1e3),e=!1},a=function(){Core.debug&&ConsoleLogger.log("Core","Handling DataLoader fail"),UIManager.closeLoadOverlay(),DataLoader.getStatus()!=DataLoaderStatus.CANCELLED&&UIManager.openModal(UIManager.loadErrorModal)};return{baseURL:"",dataURL:"",appSelector:"",title:"Studio Planner",debug:!1,init:function(e,t,a,n){this.baseURL=e,this.dataURL=t,this.appSelector=a,this.debug=n,Core.debug&&ConsoleLogger.startTimer("Core.init()"),SettingsManager.init(),UIManager.init(),UIManager.buildComponents(),this.loadData(SettingsManager.getSetting("startDate"),SettingsManager.getSetting("endDate"),SettingsManager.getSetting("dateRangeSize"))},loadData:function(e,n,r){UIManager.openLoadOverlay();var o=DateFactory.getDates(e,n,r,!0),i=DateTimeFormatter.getSimpleFormat(o[0]),s=DateTimeFormatter.getSimpleFormat(o[o.length-1]);this.title=i+" - "+s,DataLoader.load(o,t,a)}}}();